pipelines:
  branches:
    9.x-dev:
      - step:
          name: Build and Install
          image: drud/ddev-webserver:v1.16.1
          script:
            - git fetch
            - git checkout 9.x
            - git merge --strategy-option theirs 9.x-dev
            - git checkout 9.x-dev .
            - composer install
            - npm install
            - echo "// @ts-nocheck" | cat - public/typo3/sysext/backend/Resources/Private/TypeScript/Modal.ts > temp && mv temp public/typo3/sysext/backend/Resources/Private/TypeScript/Modal.ts
            - npm run build
            - chmod +x Build/Scripts/cleanUp.sh && ./Build/Scripts/cleanUp.sh
            - git add *
            - git commit -a -m "Build $BITBUCKET_COMMIT"
            - git push --tags origin 9.x:9.x
